"use strict";var app=angular.module("jobBoardApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngGrid","jobBoardApp.applicant","jobBoardApp.company","firebase","google-maps","angular-geo","angular-geo-providers.google","angularGeoFire"]).constant("FIREBASE_URL","https://jobboard.firebaseio.com/").config(["$routeProvider","angularGeoProvider","angularGeoGoogleProvider",function(a,b,c){a.when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl"}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl"}).when("/testdata",{templateUrl:"views/test-data.html",controller:"TestDataCtrl"}).when("/",{redirectTo:"/search"}).otherwise({redirectTo:"/search"}),b.addProvider(c.name)}]);app.factory("Job",["$geofire","FIREBASE_URL",function(a,b){var c=[],d=a(new Firebase(b+"restaurants")),e={listings:c,search:function(a,b,e){d.$getPointsNearLoc([a,b],e).then(function(a){c.length=0,angular.forEach(a,function(a){c.isSelected=!1,c.hasApplied=!1,c.hasAppliedText="",c.applicants=[],c.push(a)})})},update:function(a){delete a.hasApplied,delete a.isSelected,delete a.hasAppliedText,d.$insertByLocWithId([a.coords.latitude,a.coords.longitude],a.restaurant,a).catch(function(a){console.log(a)})}};return e}]);var applicant=angular.module("jobBoardApp.applicant",["ngRoute","ngGrid","ui.mask","ngResource","focusOn"]).config(["$routeProvider",function(a){a.when("/applicant/profile",{templateUrl:"views/applicant/profile.html",controller:"ProfileCtrl"}).when("/applicant/schedule",{templateUrl:"views/applicant/schedule.html",controller:"ScheduleCtrl"}).when("/applicant/experience",{templateUrl:"views/applicant/experience.html",controller:"ExperienceCtrl"})}]);app.factory("User",["$firebase","FIREBASE_URL","Auth","$rootScope","$q",function(a,b,c,d,e){function f(a){d.currentUser=j.findByUsername(a),d.currentUser.$on("loaded",function(){i.resolve(d.currentUser)})}var g=new Firebase(b+"users"),h=a(g),i=e.defer(),j={create:function(a,b){h[b]={md5_hash:a.md5_hash,username:b,$priority:a.uid},h.$save(b).then(function(){f(b)})},findByUsername:function(a){return a?h.$child(a):void 0},getCurrent:function(){return i.promise},signedIn:function(){return void 0!==d.currentUser}};return d.$on("$firebaseSimpleLogin:login",function(b,c){var d=a(g.startAt(c.uid).endAt(c.uid));d.$on("loaded",function(){f(d.$getIndex()[0])})}),d.$on("$firebaseSimpleLogin:logout",function(){delete d.currentUser}),j}]),app.factory("Lookup",["$firebase","FIREBASE_URL","$filter",function(){var a=[{key:"AL",value:"Alabama"},{key:"AK",value:"Alaska"},{key:"AZ",value:"Arizona"},{key:"AR",value:"Arkansas"},{key:"CA",value:"California"},{key:"CO",value:"Colorado"},{key:"CT",value:"Connecticut"},{key:"DE",value:"Delaware"},{key:"DC",value:"District of Columbia"},{key:"FL",value:"Florida"},{key:"GA",value:"Georgia"},{key:"HI",value:"Hawaii"},{key:"ID",value:"Idaho"},{key:"IL",value:"Illinois"},{key:"IN",value:"Indiana"},{key:"IA",value:"Iowa"},{key:"KS",value:"Kansas"},{key:"KY",value:"Kentucky"},{key:"LA",value:"Louisiana"},{key:"ME",value:"Maine"},{key:"MD",value:"Maryland"},{key:"MA",value:"Massachusetts"},{key:"MI",value:"Michigan"},{key:"MN",value:"Minnesota"},{key:"MS",value:"Mississippi"},{key:"MO",value:"Missouri"},{key:"MT",value:"Montana"},{key:"NE",value:"Nebraska"},{key:"NV",value:"Nevada"},{key:"NH",value:"New Hampshire"},{key:"NJ",value:"New Jersey"},{key:"NM",value:"New Mexico"},{key:"NY",value:"New York"},{key:"NC",value:"North Carolina"},{key:"ND",value:"North Dakota"},{key:"OH",value:"Ohio"},{key:"OK",value:"Oklahoma"},{key:"OR",value:"Oregon"},{key:"PA",value:"Pennsylvania"},{key:"RI",value:"Rhode Island"},{key:"SC",value:"South Carolina"},{key:"SD",value:"South Dakota"},{key:"TN",value:"Tennessee"},{key:"TX",value:"Texas"},{key:"UT",value:"Utah"},{key:"VT",value:"Vermont"},{key:"VA",value:"Virginia"},{key:"WA",value:"Washington"},{key:"WV",value:"West Virginia"},{key:"WI",value:"Wisconsin"},{key:"WY",value:"Wyoming"}],b={all:a};return b}]),app.factory("Applicant",["$firebase","FIREBASE_URL","User",function(a,b,c){var d=new Firebase(b+"applicants"),e=a(d),f={all:e,create:function(a){c.signedIn()&&c.getCurrent().then(function(){return e[a]={foo:"bar"},e.$save(a)})},update:function(a){if(c.signedIn()){var b=a.$id;return e[b]=a,e.$save(b).then(function(){})}},find:function(a){return e.$child(a)},"delete":function(a){if(c.signedIn()){var b=f.find(a);b.$on("loaded",function(){var d=c.findByUserName(b.owner);e.$remove(a).then(function(){d.$child("applicants").$remove(a)})})}}};return f}]),app.factory("Auth",["$firebaseSimpleLogin","FIREBASE_URL","$rootScope",function(a,b,c){var d=new Firebase(b),e=a(d),f={register:function(a){return e.$createUser(a.email,a.password)},signedIn:function(){return null!==e.user},login:function(a){return e.$login("password",a)},logout:function(){e.$logout()}};return c.signedIn=function(){return f.signedIn()},f}]),applicant.controller("ProfileCtrl",["$scope","Applicant","User","$location",function(a,b,c,d){a.submitted=!1,c.getCurrent().then(function(c){a.applicant=b.find(c.$id)}),a.saveProfile=function(a,c){c.$invalid||b.update(a).then(function(){d.path("/applicant/schedule")})}}]),angular.module("jobBoardApp.applicant").controller("ScheduleCtrl",["$scope","Applicant","User","$location",function(a,b,c,d){c.getCurrent().then(function(c){a.applicant=b.find(c.$id),e()});var e=function(){a.applicant.schedule||(a.applicant.schedule=[{name:"Monday",lunch:!1,dinner:!1},{name:"Tuesday",lunch:!1,dinner:!1},{name:"Wednesday",lunch:!1,dinner:!1},{name:"Thursday",lunch:!1,dinner:!1},{name:"Friday",lunch:!1,dinner:!1},{name:"Saturday",lunch:!1,dinner:!1},{name:"Sunday",lunch:!1,dinner:!1}])};a.allLunch=!0,a.allDinner=!0,a.saveSchedule=function(a){b.update(a),d.path("/applicant/experience")},a.selectAllLunch=function(){$.each(a.applicant.schedule,function(b){a.applicant.schedule[b].lunch=a.allLunch}),a.allLunch=!a.allLunch},a.selectAllDinner=function(){$.each(a.applicant.schedule,function(b){a.applicant.schedule[b].dinner=a.allDinner}),a.allDinner=!a.allDinner},a.selectItem=function(a,b){a[b]=!a[b]};var f='<div class="ngHeaderText" style="cursor:pointer;" ng-click="selectAllLunch()">Lunch <input class="ngSelectionCheckbox" type="checkbox" ng-checked="!allLunch" /></div>',g='<div class="ngHeaderText" ng-click="selectAllDinner()">Dinner <input class="ngSelectionCheckbox" type="checkbox" ng-checked="!allDinner" /></div>';a.gridOptions={data:"applicant.schedule",enableSorting:!1,enableRowSelection:!1,columnDefs:[{field:"name",displayName:""},{field:"lunch",displayName:"Lunch",cellTemplate:'<div class="ngSelectionCell" ng-click="selectItem(row.entity, \'lunch\')"><input class="ngSelectionCheckbox" type="checkbox" ng-checked="row.entity.lunch" /></div>',headerCellTemplate:f},{field:"dinner",displayName:"Dinner",cellTemplate:'<div class="ngSelectionCell" ng-click="selectItem(row.entity, \'dinner\')"><input tabindex="-1" class="ngSelectionCheckbox" type="checkbox" ng-checked="row.entity.dinner" /></div>',headerCellTemplate:g}]}}]),angular.module("jobBoardApp.applicant").controller("ExperienceCtrl",["$scope","Applicant","User","$location","$log","focus",function(a,b,c,d,e,f){c.getCurrent().then(function(c){a.applicant=b.find(c.$id),g()});var g=function(){a.applicant.experience||(a.applicant.experience=[])};a.job={company:"",position:"",monthsWorked:""},a.submitted=!1,a.saveJob=function(c,d){c.$invalid||(a.applicant.experience.push(d),a.job={company:"",position:"",monthsWorked:""},f("newItemAdded"),b.update(a.applicant),a.submitted=!1)},a.editJob=function(c){a.job=a.applicant.experience[c],a.applicant.experience.splice(c,1),b.update(applicant)},a.done=function(){d.path("/search")}}]),angular.module("jobBoardApp.applicant").directive("experienceRecord",function(){return{restrict:"E",transclude:!0,scope:{company:"@",position:"@",monthsWorked:"@",edit:"&",index:"@"},template:"<span><strong>{{position}}</strong></span><span> @<strong>{{company}}</strong></span><span> For <strong>{{monthsWorked}}</strong> months</span><span ng-transclude></span>"}});var company=angular.module("jobBoardApp.company",["ngRoute"]).config(["$routeProvider",function(a){a.when("/company/profile",{templateUrl:"views/company/profile.html",controller:"ProfileCtrl"})}]);app.filter("schedule",function(){return function(a){angular.forEach(a,function(a){angular.forEach(a.schedule,function(a){a.lunch,a.dinner})})}}),app.controller("SearchCtrl",["$scope","filterFilter","Job","angularGeo","$geofire","FIREBASE_URL","Lookup","User","Applicant",function(a,b,c,d,e,f,g,h,i){h.getCurrent().then(function(b){b&&(a.applicant=i.find(b.$id))}),a.listings=c.listings,a.states=g.all,a.searchCoords={latitude:"",longitude:"",dist:15},a.filterOptions={filterText:""},a.apply=function(a){a.hasApplied=!0,a.hasAppliedText="You Applied"},a.selectMarker=function(b){angular.forEach(a.listings,function(c,d){c.restaurant===b.restaurant?(a.gridOptions.selectItem(d,!0),c.isSelected=!0):(a.gridOptions.selectItem(d,!1),c.isSelected=!1)})},a.selectRow=function(b){angular.forEach(a.listings,function(a){a.isSelected=a.restaurant===b.restaurant?!0:!1})};var j='<div class="ngSelectionCell"><button type="submit" style="font-size:12; padding:5px; " class="btn btn-primary" ng-click="apply(row.entity)" ng-hide="row.entity.hasApplied">Apply Now</button><span>{{row.entity.hasAppliedText}}</span></div>';a.gridOptions={data:"listings",enableSorting:!0,filterOptions:a.filterOptions,keepLastSelected:!1,multiSelect:!1,columnDefs:[{field:"restaurant",displayName:"Restaurant"},{field:"position",displayName:"Position"},{field:"",displayName:"",cellTemplate:j}],rowHeight:40,rowTemplate:'<div ng-style="{\'cursor\': row.cursor, \'z-index\': col.zIndex() }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}" ng-cell ng-click="selectRow(row.entity)"></div>'},a.map={center:{latitude:"",longitude:""},zoom:10,control:{}};var k=function(b,c){a.map.center.latitude=b,a.map.center.longitude=c},l=function(){c.search(a.searchCoords.latitude,a.searchCoords.longitude,a.searchCoords.dist)},m=new google.maps.Geocoder;a.proximitySearch=function(){m.geocode({address:a.city+", "+a.state.key},function(b){a.searchCoords.latitude=b[0].geometry.location.k,a.searchCoords.longitude=b[0].geometry.location.A,l(),a.map.control.refresh({latitude:a.searchCoords.latitude,longitude:a.searchCoords.longitude})})};var n=function(b,c){var d=new google.maps.LatLng(b,c);m.geocode({latLng:d},function(b){var c=b[0];a.city=c.address_components[3].short_name;var d=c.address_components[5].short_name;angular.forEach(a.states,function(b,c){b.key===d&&(a.state=a.states[c])})})};d.getCurrentPosition().then(function(b){a.searchCoords.latitude=b.coords.latitude,a.searchCoords.longitude=b.coords.longitude,k(a.searchCoords.latitude,a.searchCoords.longitude),l(),n(a.searchCoords.latitude,a.searchCoords.longitude)})}]),app.controller("AuthCtrl",["$scope","$location","$timeout","Auth","User","Applicant",function(a,b,c,d,e,f){d.signedIn()&&b.path("/"),a.$on("$firebaseSimpleLogin:login",function(){b.path("/")}),a.submitted=!1,a.login=function(){d.login(a.user).then(function(){b.path("/")},function(b){a.error=b.toString()})},a.register=function(g){g.$invalid||d.register(a.user).then(function(g){d.login(a.user).then(function(){e.create(g,a.user.username),c(function(){f.create(a.user.username),b.path("/applicant/profile")},2e3)})},function(b){a.error=b.toString()})}}]),app.controller("NavCtrl",["$scope","Auth","Job",function(a,b,c){a.logout=function(){b.logout()},a.jobs=c}]),app.controller("TestDataCtrl",["$scope","$geofire","FIREBASE_URL","Job",function(a,b,c,d){b(new Firebase(c+"restaurants"));a.jobs=d}]);